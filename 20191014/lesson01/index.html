<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style_pc.css">
    <style>
        button{
            /*display: block;*/
            width:100%;
            margin-top:20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-5">
                <form action="" id="form1">
                    <div class="form-group">
                        <label for="startText">翻譯區塊</label>
                        <textarea id="startText" class="form-control" rows="10" name="Text"></textarea>
                    </div>
                </form>
            </div>
            <div class="col-lg-2">
                <button id="goT" class="btn btn-primary" type="button" >--＞</button>
                <button id="goB" class="btn btn-primary" type="button" >＜--</button>
                <button id="myDelete" class="btn btn-primary" type="button" >刪除</button>
            </div>
            <div class="col-lg-5">
                <form action="" id="form2">
                    <div class="form-group">
                        <label for="endText">翻譯區塊</label>
                        <textarea id="endText" class="form-control" rows="10" name="Text"></textarea>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        
        var source="";
        var target="";
        $(document).ready(function () {
            $("#goT").click(goright);
            $("#goB").click(goleft);
            $("#myDelete").click(deleteStorage);

            if(localStorage.getItem('data1')!=null){
                //localStorage.key(1)               第一個key值
                //localStorage.getItem('data1')     取得value值
                //localStorage.data1                取得value值
                $("#startText").val(localStorage.data1);

                $("#endText").val(localStorage.data2);
            }
            
        });

        //刪除資料庫的資料
        function deleteStorage(){
            localStorage.removeItem("data1");
            localStorage.removeItem("data2");
            //localStorage.clear();
        }
        //存進儲存庫的資料
        function saveStorage(){
            localStorage.setItem("data1",$("#startText").val());
            localStorage.setItem("data2",$("#endText").val());
        }

        function goright(){
            source = JSON.stringify($("#form1").serializeObject());//{"Text":"翻譯測試"}
            target="#endText";          
            goTrans();
        }
        function goleft(){
            source = JSON.stringify($("#form2").serializeObject());//{"Text":"翻譯測試"}
            target="#startText";
            goTrans();
        }
        
        //將全表單轉json 也能指定幾個input
        $.fn.serializeObject = function(){
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };

        function goTrans(){

            $.ajax({
                type: "post", //http verb
                headers: {
                    //http header
                    "Ocp-Apim-Subscription-Key": "535c31d975084cf98ef5d459e1318ae2",
                    "Content-Type": "application/json"
                },
                url: "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=ja&to=ko&to=en",
                data: '['+source+']', //[{"Text":"翻譯測試"}] api的接收 規定外面再包一個陣列 因為可能不只翻一句話
                dataType: "json",
                success: function (response) {
                    //$(target).val(response[0].translations[0].text);
                    //方法一 (回傳多筆資料)
                    var result = "";
                    var data = response[0].translations;//取得translations陣列 陣列中存的是物件
                    for(var j=0;j<data.length;j++){
                        result+=data[j].text+"\t";//取得物件中的text內容
                    }
                    $(target).val(result);
                    saveStorage();//儲存進javaScript的儲存庫
                }
            });
        }
        /*
        [
            {
                "detectedLanguage": {
                    "language": "zh-Hant",
                    "score": 1.0
                },
                "translations": [
                    {
                        "text": "こんにちは、誰もが今日それを持っていますか?",
                        "to": "ja"
                    },
                    {
                        "text": "이봐, 오늘 어떻게 하고 있니?",
                        "to": "ko"
                    },
                    {
                        "text": "Hey, how are you doing today?",
                        "to": "en"
                    }
                ]
            }
        ]
        */
    </script>
</body>
</html>